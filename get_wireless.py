#!/usr/bin/env python3

wireless_xpm =\
[
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ..        ..  \",",
        "\" .            . \",",
        "\".              .\",",
        "\".              .\",",
        "\" .            . \",",
        "\"  .          .  \",",
        "\"   .        .   \",",
        "\"    .      .    \",",
        "\"     .    .     \",",
        "\"      .  .      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ..        ..  \",",
        "\" .            . \",",
        "\".              .\",",
        "\".              .\",",
        "\" .            . \",",
        "\"  .          .  \",",
        "\"   .        .   \",",
        "\"    .      .    \",",
        "\"     .    .     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ..        ..  \",",
        "\" .            . \",",
        "\".              .\",",
        "\".              .\",",
        "\" .            . \",",
        "\"  .          .  \",",
        "\"   .        .   \",",
        "\"    .      .    \",",
        "\"     ......     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ..        ..  \",",
        "\" .            . \",",
        "\".              .\",",
        "\".              .\",",
        "\" .            . \",",
        "\"  .          .  \",",
        "\"   .        .   \",",
        "\"    ........    \",",
        "\"     ......     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ..        ..  \",",
        "\" .            . \",",
        "\".              .\",",
        "\".              .\",",
        "\" .            . \",",
        "\"  .          .  \",",
        "\"   ..........   \",",
        "\"    ........    \",",
        "\"     ......     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ..        ..  \",",
        "\" .            . \",",
        "\".              .\",",
        "\".              .\",",
        "\" .            . \",",
        "\"  ............  \",",
        "\"   ..........   \",",
        "\"    ........    \",",
        "\"     ......     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ..        ..  \",",
        "\" .            . \",",
        "\".              .\",",
        "\".              .\",",
        "\" .............. \",",
        "\"  ............  \",",
        "\"   ..........   \",",
        "\"    ........    \",",
        "\"     ......     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ..        ..  \",",
        "\" .            . \",",
        "\".              .\",",
        "\"................\",",
        "\" .............. \",",
        "\"  ............  \",",
        "\"   ..........   \",",
        "\"    ........    \",",
        "\"     ......     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ..        ..  \",",
        "\" .            . \",",
        "\"................\",",
        "\"................\",",
        "\" .............. \",",
        "\"  ............  \",",
        "\"   ..........   \",",
        "\"    ........    \",",
        "\"     ......     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ..        ..  \",",
        "\" .............. \",",
        "\"................\",",
        "\"................\",",
        "\" .............. \",",
        "\"  ............  \",",
        "\"   ..........   \",",
        "\"    ........    \",",
        "\"     ......     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ..    ..    \",",
        "\"  ............  \",",
        "\" .............. \",",
        "\"................\",",
        "\"................\",",
        "\" .............. \",",
        "\"  ............  \",",
        "\"   ..........   \",",
        "\"    ........    \",",
        "\"     ......     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
    [
        "\"      ....      \",",
        "\"    ........    \",",
        "\"  ............  \",",
        "\" .............. \",",
        "\"................\",",
        "\"................\",",
        "\" .............. \",",
        "\"  ............  \",",
        "\"   ..........   \",",
        "\"    ........    \",",
        "\"     ......     \",",
        "\"      ....      \",",
        "\"       ..       \",",
        "\"       ..       \",",
        "\"                \",",
        "\"                \",",
    ],
]

from utils import writexpm
from os.path import expanduser

def writewirelessxpm(lvl, col):
    url = expanduser("~/.xmonad/xpm/wireless_%d_%%s.xpm") % lvl

    return writexpm(url, wireless_xpm[lvl], col)

import sys, subprocess, wireless

w = wireless.Wireless()

enabled = w.power()
print("Enabled: %s" % enabled, file=sys.stderr)

if not enabled:
    name = ""
    lvl  = 0
    col  = "red"
else:
    name = w.current()
    print("Network: %s" % name, file=sys.stderr)

    col = "white"
    if name is None:
        name = ""
        lvl  = 0
    else:
        wifi_strength = int(subprocess.getoutput("awk 'NR==3 {print $3}''' /proc/net/wireless")[:-1])
        print("Strength: %d%%" % wifi_strength, file=sys.stderr)

        lvl = wifi_strength // 10 + 1
        name = " " + name

out = "<icon=%s/>%s"
toggle = "<action=`~/.xmonad/toggle_wireless.sh` button=1>%s</action>"
nmtui = "<action=`terminator -e nmtui` button=3>%s</action>"

print(nmtui % toggle % out % (writewirelessxpm(lvl, col), name))
